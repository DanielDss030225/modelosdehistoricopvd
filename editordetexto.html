<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="diligencissautor.css">
        <title>Modelos de Históricos PVD</title>
    
        <link rel="icon" type="image/png" href="logo.png"> 
      <script src="./editorTexto.js"></script>
      <script src="./atualizarDados.js"></script>
      <script type="module" src="./firebaseConfig.js"></script>

       
    </head>


  
<body class="container">

<script>
  window.onload = function () {
  showText(); // Chama sua função aqui
};

</script>

<div id="alertaSucesso" class="alerta-sucesso" style="display: none;">
  Pronto! Novos dados alterados e salvos com sucesso!
</div>


  <div id="loading-screen" style="
    position: fixed;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    z-index: 9999;">
    Carregando...
</div>


  <div class="cabeçalho">
         <a class="aImagem" href="index.html">
      
        <img class="imagem" src="logo.png">
    
      
       

    </a>

    <p class="User" id="user-info">Carregando...</p>
    <button onclick="logout()">Sair</button>
  
  
  </div>
 


  
 <div class="fundotela">

  <!-- Div do alerta oculta inicialmente -->
  <div id="fullscreenAlert" class="alert-fullscreen" style="display: none;">
    <div class="elementoP" >
      <p class="MensagemFechar" >É preciso preencher o NOME e RG da vítima!</p>
      <button id="closeAlert">Fechar</button>
    </div>
  </div>

<div class="maxlargura">
  
 

 <div class="larguraDoTitulo">
  

  <h3 id="titulopag"> &nbsp &nbsp Carregando Título &nbsp &nbsp </h3>
  

 </div>

  


 

    <fieldset> 
      
      <legend> Digite os dados da vítima</legend>
        <ul> 

   <li>
        
     <input onblur="this.value = this.value.trim(), obterDadosDoFirebase(), mostrarCarregamento();" class="tamanhorg" id="rgvitima"  type="number" placeholder="RG DA VÍTIMA" >                           
            
     
 </li> 
 <li> 
  <input  onblur="this.value = this.value.trim();" id="nomevitima" type="text" placeholder="NOME DA VÍTIMA" >                  


 </li>
  <li> 
  <input  onblur="this.value = this.value.trim();" id="cpfvitima" type="number" placeholder="CPF DA VÍTIMA" >                  


 </li>
       <li>
        <input onblur="this.value = this.value.trim();"  class="ocorrencia" id="telefonevitima" type="tel" placeholder="TELEFONE DA VÍTIMA" > 

       </li>   
       </ul>  

<ul> 
     <li class="ulEndereco">
    <input  onblur="this.value = this.value.trim();" class="ocorrencia" id="ocupacaoVitima" type="text" placeholder="OCUPAÇÃO ATUAL" > 

  </li>
     <li class="ulEndereco">
    <input  onblur="this.value = this.value.trim();" class="ocorrencia" id="enderecoVitima" type="text" placeholder="ENDEREÇO DA VÍTIMA" > 

  </li>
</ul> 

      </fieldset>


     
 
    

      
      <fieldset> 

        <legend> Digite os dados do autor</legend>
                    <ul>

  <li>
    <input onblur="this.value = this.value.trim();" id="rgautor"  class="tamanhorg" type="number" placeholder="RG DO AUTOR" >                           

  </li>
  <li>
    <input onblur="this.value = this.value.trim();"  id="nomeautor" type="text" placeholder="NOME DO AUTOR"   > 


  </li>
   <li> 
  <input  onblur="this.value = this.value.trim();" id="cpfautor" type="number" placeholder="CPF DA AUTOR" >                  


 </li>
  <li>
    <input  onblur="this.value = this.value.trim();" class="ocorrencia" id="telefoneautor" type="tel" placeholder="TELEFONE DO AUTOR" > 

  </li>
  
  </ul>

  <ul>
     <li class="ulEndereco">
    <input  onblur="this.value = this.value.trim();" class="ocorrencia" id="ocupacaoAutor" type="text" placeholder="OCUPAÇÃO ATUAL" > 

  </li>
 <li class="ulEndereco">
    <input  onblur="this.value = this.value.trim();" class="ocorrencia" id="enderecoAutor" type="text" placeholder="ENDEREÇO DO AUTOR" > 

  </li>

 </ul>
 

</fieldset>

    <fieldset>
      <legend> Dados complementares</legend>

<ul> 



 <li class="ulEndereco">

  <input class="dadosComplementares" onblur="this.value = this.value.trim();" class="ocorrencia"  id="redsorigem" type="text" placeholder="REDS DE ORIGEM"   > 

</li>

 <li class="ulEndereco">

  <input   class="dadosComplementares" onblur="this.value = this.value.trim();"  class="ocorrencia" id="medidaprotetiva" type="tel" placeholder="MEDIDA PROTETIVA" > 

</li>
  
</ul>

    </fieldset>
 
 


 

<div class="buttongerar">
 
  <ul>

<a id="showAlert">
  <li class="cardGerar">

    <p class="selction"> Atualizar Dados</p>
  
  </li>
  <h3 class="mensagem"> Este botão substitui os "*******" pelos dados do formulário</h3>
</a>
    
  </ul>

  

</div>


<ul>





  <div class="divEditor">  
  <fieldset class="fieldsetEditor"> 
    <legend> Edite seu histórico</legend>
    <div class="row">
    <div class="col-12">

        <textarea  name="descricao" id="idteste" cols="60" rows="10" placeholder="Modelo de histórico" class="descricao"></textarea>
    </div>



</fieldset>

</div>
</ul>
<div class="center">
  <button onclick="copiarTexto()">Copiar texto</button>

</div>

  
</div>





</div>







<script type="module">
    
    // Importar as funções necessárias do SDK
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-auth.js";
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-app.js";
    import { set, getDatabase, ref, get, } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-database.js";
 
  // Configuração do Firebase
  const firebaseConfig = {
      apiKey: "AIzaSyDQWO9csuYqrd0JyXa_cs4f3jAsjQAEWSw",
      authDomain: "meu-site-fd954.firebaseapp.com",
      projectId: "meu-site-fd954",
      storageBucket: "meu-site-fd954.firebasestorage.app",
      messagingSenderId: "1062346912662",
      appId: "1:1062346912662:web:0f41873e12965c545363b7",
      measurementId: "G-5HXX5ZZKER"
    };
     
    
// Inicializar o Firebase
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth(app); // Obtém corretamente a instância de autenticação

// Verifica o usuário autenticado
onAuthStateChanged(auth, (user) => {
    if (user) {
        document.getElementById("user-info").innerText = `Usuário: ${user.email}`;
    } else {
        document.getElementById("user-info").innerText = "Nenhum usuário autenticado";
        window.location.href = "login.html"; // Redireciona para login se não estiver logado
    }
});

// Função para sair da conta
window.logout = function () {
    signOut(auth).then(() => {
        window.location.href = "login.html";
    }).catch(error => {
        console.error("Erro ao sair:", error);
    });
}


   window.obterDadosDoFirebase = function (path, dados)  {



  const rgvitimavalor = document.getElementById("rgvitima").value  
  
  console.log(rgvitimavalor);   

   //// A FUÇÃO ESTAVA AQUI
  

  const valorDoInput = "DADOS/" + rgvitimavalor;
  // Referência para o nó específico no Firebase

  const dbRef = ref(db, valorDoInput);

get(dbRef)
    .then((snapshot) => {

      
    
      ocultarCarregamento() 
      
if (!rgvitimavalor) {
  console.error("É necessário digitar o RG da vítima!"  );
 
  return 
;
}
const lista = snapshot.val();
      console.log(lista);// Exibe a lista completa no console
        //AJUSTA VALOR PARA O VALOR DO SNAPSHOT
          const valor = snapshot.val();
          
    //FUNÇÃO QUE CONVERTE UMA LISTA JSON PARA ARRAY
    function converterParaArray(valor) {
      if (!Array.isArray(valor)) {
          console.error("ERRO: RG Não cadastrado no sistema!", valor);
        return ['', '', '', '', '', '', '', '', '', '', '',]; // Retorna um array vazio para evitar erro
      }

      return valor.map(item => item === null ? "NULL" : String(item));
  }

  
  // Exemplo de uso
  const valorTeste = valor; // Obtém a lista do Firebase     
  const valorLista = valorTeste;
  const entrada = JSON.parse(valorLista); // Converte a string JSON em um array
  const resultado = converterParaArray(entrada);
  
  console.log(resultado);
   


  
 
  //FUNÇÃO QUE OBTEM INDICES DE UMA LISTA 0
  function indice0(resultado, indice00) {
    // Verifica se o índice está dentro do intervalo válido
    if (indice00 >= 0 && indice00 < resultado.length) {
      return resultado[indice00];
    } else {
      return "";
    }
  }
  // Exemplo de uso
  const lista0 = resultado;
  const indice00 = 0; // Índice do elemento que deseja obter
  const elemento0 = indice0(lista0, indice00);
  console.log(elemento0); // Saída: 
  
  //FUNÇÃO QUE OBTEM INDICES DE UMA LISTA 1
  function indice1(resultado, indice11) {
    // Verifica se o índice está dentro do intervalo válido
    if (indice11 >= 1 && indice11 < resultado.length) {
      return resultado[indice11];
    } else {
      return "";
    }
  }
  // Exemplo de uso
  const lista1 = resultado;
  const indice11 = 1; // Índice do elemento que deseja obter
  const elemento1 = indice1(lista1, indice11);
  console.log(elemento1); // Saída:
  
  
  
  //FUNÇÃO QUE OBTEM INDICES DE UMA LISTA 2
  function indice2(resultado, indice22) {
    // Verifica se o índice está dentro do intervalo válido
    if (indice22 >= 2 && indice22 < resultado.length) {
      return resultado[indice22];
    } else {
      return "";
    }
  }
  // Exemplo de uso
  const lista2 = resultado;
  const indice22 = 2; // Índice do elemento que deseja obter
  const elemento2 = indice2(lista2, indice22);
  console.log(elemento2); // Saída: 
  
  
  //FUNÇÃO QUE OBTEM INDICES DE UMA LISTA 3
  function indice3(resultado, indice33) {
    // Verifica se o índice está dentro do intervalo válido
    if (indice33 >= 3 && indice33 < resultado.length) {
      return resultado[indice33];
    } else {
      return "";
    }
  }
  // Exemplo de uso
  const lista3 = resultado;
  const indice33 = 3; // Índice do elemento que deseja obter
  const elemento3 = indice3(lista3, indice33);
  console.log(elemento3); // Saída: 
  
  
  //FUNÇÃO QUE OBTEM INDICES DE UMA LISTA 4
  function indice4(resultado, indice44) {
    // Verifica se o índice está dentro do intervalo válido
    if (indice44 >= 4 && indice44 < resultado.length) {
      return resultado[indice44];
    } else {
      return "";
    }
  }
  // Exemplo de uso
  const lista4 = resultado;
  const indice44 = 4; // Índice do elemento que deseja obter
  const elemento4 = indice4(lista4, indice44);
  console.log(elemento4); // Saída: 
  
  
  
  //FUNÇÃO QUE OBTEM INDICES DE UMA LISTA 5
  function indice5(resultado, indice55) {
    // Verifica se o índice está dentro do intervalo válido
    if (indice55 >= 5 && indice55 < resultado.length) {
      return resultado[indice55];
    } else {
      return "";
    }
  }
  // Exemplo de uso
  const lista5 = resultado;
  const indice55 = 5; // Índice do elemento que deseja obter
  const elemento5 = indice5(lista5, indice55);
  console.log(elemento5); // Saída: 
  
  
  //FUNÇÃO QUE OBTEM INDICES DE UMA LISTA 6
  function indice6(resultado, indice66) {
    // Verifica se o índice está dentro do intervalo válido
    if (indice66 >= 6 && indice66 < resultado.length) {
      return resultado[indice66];
    } else {
      return "";
    }
  }
  // Exemplo de uso
  const lista6 = resultado;
  const indice66 = 6; // Índice do elemento que deseja obter
  const elemento6 = indice3(lista6, indice66);
  console.log(elemento6); // Saída: 

  
   //FUNÇÃO QUE OBTEM INDICES DE UMA LISTA 7
  function indice7(resultado, indice77) {
    // Verifica se o índice está dentro do intervalo válido
    if (indice77 >= 7 && indice77 < resultado.length) {
      return resultado[indice77];
    } else {
      return "";
    }
  }
  // Exemplo de uso
  const lista7 = resultado;
  const indice77 = 7; // Índice do elemento que deseja obter
  const elemento7 = indice3(lista7, indice77);
  console.log(elemento7); // Saída: 
  


  //FUNÇÃO QUE OBTEM INDICES DE UMA LISTA 8
  function indice8(resultado, indice88) {
    // Verifica se o índice está dentro do intervalo válido
    if (indice88 >= 8 && indice88 < resultado.length) {
      return resultado[indice88];
    } else {
      return "";
    }
  }
  // Exemplo de uso
  const lista8 = resultado;
  const indice88 = 8; // Índice do elemento que deseja obter
  const elemento8 = indice3(lista8, indice88);
  console.log(elemento8); // Saída: 
  

 //FUNÇÃO QUE OBTEM INDICES DE UMA LISTA 9
  function indice9(resultado, indice99) {
    // Verifica se o índice está dentro do intervalo válido
    if (indice99 >= 9 && indice99 < resultado.length) {
      return resultado[indice99];
    } else {
      return "";
    }
  }
  // Exemplo de uso
  const lista9 = resultado;
  const indice99 = 9; // Índice do elemento que deseja obter
  const elemento9 = indice3(lista9, indice99);
  console.log(elemento9); // Saída: 


  
 //FUNÇÃO QUE OBTEM INDICES DE UMA LISTA 10
  function indice10(resultado, indice1010) {
    // Verifica se o índice está dentro do intervalo válido
    if (indice1010 >= 10 && indice1010 < resultado.length) {
      return resultado[indice1010];
    } else {
      return "";
    }
  }
  // Exemplo de uso
  const lista10 = resultado;
  const indice1010 = 10; // Índice do elemento que deseja obter
  const elemento10 = indice3(lista10, indice1010);
  console.log(elemento10); // Saída: 



   //FUNÇÃO QUE OBTEM INDICES DE UMA LISTA 11
  function indice10(resultado, indice1111) {
    // Verifica se o índice está dentro do intervalo válido
    if (indice1111 >= 11 && indice1111< resultado.length) {
      return resultado[indice1111];
    } else {
      return "";
    }
  }
  // Exemplo de uso
  const lista11 = resultado;
  const indice1111 = 11; // Índice do elemento que deseja obter
  const elemento11 = indice3(lista11, indice1111);
  console.log(elemento11); // Saída: 


   //FUNÇÃO QUE OBTEM INDICES DE UMA LISTA 12
  function indice10(resultado, indice1212) {
    // Verifica se o índice está dentro do intervalo válido
    if (indice1212 >= 12 && indice1212< resultado.length) {
      return resultado[indice1212];
    } else {
      return "";
    }
  }
  // Exemplo de uso
  const lista12 = resultado;
  const indice1212 = 12; // Índice do elemento que deseja obter
  const elemento12 = indice3(lista12, indice1212);
  console.log(elemento12); // Saída: 


  //AJUSTA O VALOR DOS INPUTS
  const input0 = document.getElementById('nomevitima'); // Substitua pelo ID do seu input
    if (elemento0 == "NULL") {
      input0.value = "";
    } else {
      input0.value = elemento0;
    }
  
     const input7 = document.getElementById('cpfvitima'); // Substitua pelo ID do seu input
    if (elemento7 == "NULL") {
      input7.value = "";
    } else {
      input7.value = elemento7;
    }


  const input9 = document.getElementById('enderecoVitima'); // Substitua pelo ID do seu input0909
    if (elemento9 == "NULL") {
      input9.value = "";
    } else {
      input9.value = elemento9;
    }

const input11 = document.getElementById('ocupacaoVitima'); // Substitua pelo ID do seu input0909
    if (elemento11 == "NULL") {
      input11.value = "";
    } else {
      input11.value = elemento11;
    }

    const input1 = document.getElementById('telefonevitima'); // Substitua pelo ID do seu input
    if (elemento1 == "NULL") {
      input1.value = ""; 

    } else {
      input1.value = elemento1; 
    }
  
  const input3 = document.getElementById('nomeautor'); // Substitua pelo ID do seu input
    if (elemento3 == "NULL") {
      input3.value = ""; // Define o valor do campo de entrada com o valor obtido
    } else {
      input3.value = elemento3; // Define o valor do campo de entrada com o valor obtido
    }


   const input10 = document.getElementById('enderecoAutor'); // Substitua pelo ID do seu input
    if (elemento10 == "NULL") {
      input10.value = ""; // Define o valor do campo de entrada com o valor obtido
    } else {
      input10.value = elemento10; // Define o valor do campo de entrada com o valor obtido
    }

 const input12 = document.getElementById('ocupacaoAutor'); // Substitua pelo ID do seu input
    if (elemento12 == "NULL") {
      input12.value = ""; // Define o valor do campo de entrada com o valor obtido
    } else {
      input12.value = elemento12; // Define o valor do campo de entrada com o valor obtido
    }

  const input8 = document.getElementById('cpfautor'); // Substitua pelo ID do seu input
    if (elemento8 == "NULL") {
      input8.value = ""; // Define o valor do campo de entrada com o valor obtido
    } else {
      input8.value = elemento8; // Define o valor do campo de entrada com o valor obtido
    }

    const input4 = document.getElementById('telefoneautor'); // Substitua pelo ID do seu input
    if (elemento4 == "NULL") {
      input4.value = ""; // Define o valor do campo de entrada com o valor obtido
    } else {
      input4.value = elemento4; // Define o valor do campo de entrada com o valor obtido
    }
  
    
    const input2 = document.getElementById('rgautor'); // Substitua pelo ID do seu input
    if (elemento2 == "NULL") {
      input2.value = ""; // Define o valor do campo de entrada com o valor obtido
    } else {
      input2.value = elemento2; // Define o valor do campo de entrada com o valor obtido
    }
  
    const input5 = document.getElementById('redsorigem'); // Substitua pelo ID do seu input
    if (elemento5 == "NULL") {
      input5.value = ""; // Define o valor do campo de entrada com o valor obtido
    } else {
      input5.value = elemento5; // Define o valor do campo de entrada com o valor obtido
    }
    const input6 = document.getElementById('medidaprotetiva'); // Substitua pelo ID do seu input
    if (elemento6 == "NULL") {
      input6.value = ""; // Define o valor do campo de entrada com o valor obtido
    } else {
      input6.value = elemento6; // Define o valor do campo de entrada com o valor obtido
    }


    ocultarCarregamento()
    
  
  })


}
/**
 * Salva dados no Firebase Realtime Database.
 * @param {string} DADOS - Caminho no Realtime Database onde os dados serão salvos.
 * @param {Object} dados - Objeto com os dados a serem salvos.
 */

 function salvarDadosEmLista(DADOS, dados) {
  const rgvitimavalor01 = document.getElementById("rgvitima").value; 
  const nomevitima = document.getElementById("nomevitima").value; 
  console.log("ID da vítima:", rgvitimavalor01);
  console.log("Nome da vítima", nomevitima);

  if (!rgvitimavalor01) {
    mostrarAlerta()
    console.error("O ID da vítima está vazio. Verifique o campo de entrada.");
    return;
  }
  if (!nomevitima) {
    mostrarAlerta()
    console.error("O nome da vítima está vazio. Verifique o campo de entrada.");
    return;
  }

  
  
  const referencia = ref(db, `${DADOS}/${rgvitimavalor01}`); // Usa o rgvitimavalor01 como o nó principal

  // Aqui, você converte o array de dados para uma string JSON
  const dadosArray = JSON.stringify(dados); // Converte os dados para um formato de string JSON

  // Salva os dados como uma string representando um array
  set(referencia, dadosArray) // Salva a string JSON representando o array
    .then(() => {
      console.log("Dados salvos com sucesso no Realtime Database!");
    })
    .catch((erro) => {
      console.error("Erro ao salvar dados no Realtime Database:", erro);
    });
}

// Capturar os valores dos inputs e salvar no Firebase
document.getElementById("showAlert").addEventListener("click", () => {
  // Obter os valores dos inputs
  const nomeVitima = document.getElementById("nomevitima").value;
  const telefoneVitima = document.getElementById("telefonevitima").value;
  const rgVitima = document.getElementById("rgvitima").value;
  const cpfvitima = document.getElementById("cpfvitima").value;
  const cpfautor = document.getElementById("cpfautor").value;
  const nomeAutor = document.getElementById("nomeautor").value;
  const telefoneAutor = document.getElementById("telefoneautor").value;
  const rgAutorOutro = document.getElementById("rgautor").value;
  const redsOrigem = document.getElementById("redsorigem").value;
  const medidaProtetiva = document.getElementById("medidaprotetiva").value;
  const enderecoVitima = document.getElementById("enderecoVitima").value;
  const enderecoAutor= document.getElementById("enderecoAutor").value;
  const ocupacaoVitima= document.getElementById("ocupacaoVitima").value;
  const ocupacaoAutor= document.getElementById("ocupacaoAutor").value;

  // Criar a lista dinamicamente com os valores capturados
  const dadosLista = [
    nomeVitima || "NULL",        // Usa "N/A" caso o input esteja vazio
    telefoneVitima || "NULL",
    rgAutorOutro || "NULL",
    nomeAutor || "NULL",
    telefoneAutor || "NULL",
    redsOrigem || "NULL",
    medidaProtetiva || "NULL",
    
      cpfvitima || "NULL",
            cpfautor || "NULL",
    enderecoVitima || "NULL",
    enderecoAutor || "NULL",
    ocupacaoVitima || "NULL",
    ocupacaoAutor || "NULL",


  ];

  // Salvar no Firebase
  
  salvarDadosEmLista("DADOS", dadosLista);
  teste()
});

   
 
  </script>
  <script>
    // Seleciona os elementos
    const alertBox = document.getElementById("fullscreenAlert");
    const closeAlertButton = document.getElementById("closeAlert");


    function mostrarAlertaSucesso() {
  const alerta = document.getElementById("alertaSucesso");
  alerta.style.display = "block";

  setTimeout(() => {
    alerta.style.display = "none";
  }, 4000); // desaparece após 4 segundos
}

    // Função para mostrar o alerta
    function mostrarAlerta() {
      alertBox.style.display = "flex"; // Mostra o alerta
    }

    // Fecha o alerta
    closeAlertButton.addEventListener("click", () => {
      alertBox.style.display = "none"; // Esconde o alerta
    });

 
  </script>
  
  
  


</div>


</body>


<footer>
                  
  <p class="footerp">&nbsp &nbsp  </p>
  <p class="footerp">     Este sistema foi desenvolvido por Daniel Silva, SD PM, 3 Cia Pm Ind PVD, para facilitar o filtro e edição dos modelos de históricos criados pela Sra. Bruna CB PM, 1 Cia Pm Ind PVD.
  </p>
  <p class="footerp"> &nbsp &nbsp </p>

</footer>
</html>